if((typeof(TabCom)==="undefined")||(TabCom===null)){var TabCom={}}if((typeof(TabCom.Widgets)=="undefined")||(TabCom.Widgets===null)){TabCom.Widgets={}}(function(a,b){this.PromoParameter={CouponCode:"cc",Operation:"op",Email:"em",FirstName:"fn",LastName:"ln",TargetSiteId:"tsid",OfferId:"oid",SignupType:"st",SendToEmailList:"stel",ShareUrl:"surl",PersonalMessage:"pm",OfferText:"ot",ShareType:"sharet",SplitTestVersionId:"stvid",ReferralId:"rid"};this.ContestParameter={Operation:"op",Email:"em",FirstName:"fn",LastName:"ln",ContestId:"cid",Liked:"fbl",SignupType:"st",SurveyAnswers:"sa",OfferId:"oid"};this.PromoOperation={GenerateCode:0,EmailAndSignupUser:1,SignupUser:2,GenerateShareLink:3};this.ContestOperation={Signup:0,Like:1,Survey:2,PromoSignup:3};this.SignupType={EmailModal:0,PromoModalEmail:1,PromoModalFacebook:2,PromoModalContestEmail:3,ShareAndSave:4};this.CustomerParameter={Operation:"op",SourceCode:"sc"};this.CustomerOperation={SetSourceCode:0};this.ApplicationType={Auto:0,OnReveal:1};a.PromoParameter=this.PromoParameter;a.PromoOperation=this.PromoOperation;a.CustomerOperation=this.CustomerOperation;a.CustomerParameter=this.CustomerParameter;a.SignupType=this.SignupType;a.ApplicationType=this.ApplicationType})(TabCom.Widgets);(function(Y,a,ad){var aa=Y.PromoParameter;var Z=Y.PromoOperation;var e=Y.CustomerOperation;var f=Y.CustomerParameter;var ab=Y.SignupType;var b=Y.ApplicationType;var l=new RegExp("^[a-zA-Z0-9_]+(?:\\.[a-zA-Z0-9_]+)*@(?:[a-zA-Z0-9](?:[a-zA-Z0-9-]*[a-zA-Z0-9])?\\.)+[a-zA-Z0-9](?:[a-zA-Z0-9-]*[a-zA-Z0-9])?$");var d={invalidField:"invalid"};var x={offsetTop:0,offsetLeft:0};var v={missingDependency:"A dependency was not found. Name: ",undefinedParameter:"A parameter was undefined.  Name: ",elementNotFound:"The requested element was not found.  Element: ",noServiceResult:"The service call did not produce a result.",unknownError:"An unknown error has occurred.",invalidEmailAddress:"The requested email address was invalid.",emailAddressMismatch:"The two email addresses must match.",missingEmail:"Your email address is required."};var k={closeButton:".close-modal",email:"#txtPromoModalEmail",emailConfirm:"#EmailSignupEmailConfirm",errorContent:".error-content .message-content",closeError:".hide-error-pane",promoCodeLabel:"#promoModalPromoCode",mainPane:"#divPromoModal",confirmationPane:"#divConfirmationModal",inputBoxes:"#divPromoModalLeftCol fieldset input",firstName:"#EmailSignupFirstName",lastName:"#EmailSignupLastName",formPane:"#divPromoModalLeftCol",facebookConnect:"#facebookSignupTrigger",returnToFacebook:"#returnToFacebook",emailSignupTrigger:"#PromoModalEmailSignUp",promoModalOptionsList:"#promoModalOptionsList",promoModalEmailWrapper:"#promoModalEmailWrapper",promoHideShowWrapper:"#promoHideShowWrapper",serverErrorMessage:"#promoModalPaneWrapper .subheader-text",validationErrorMessage:"#promoModalPaneWrapper .footer-text",promoContestEmail:"#txtPromoModalContestEmail",promoContestTrigger:"#promoModalContestEmailTrigger",promoCouponCode:"#promoModalCouponCode",promoRevealPane:"#promoModalSignupSuccess"};var ac={modalVisible:false};var c={};var m=function F(af){return a.selectAndCacheElement(c,af,PromoNotifier.modalElement)};var q=function J(ah){var af=m(ah);if(!a.isDefined(af)){return}af.addClass(d.invalidField);var ag=m("label[for='"+af.attr("id")+"']");if(!a.isDefined(ag)){return}ag.addClass(d.invalidField)};var g=function C(af){if(PromoNotifier.applicationType===b.OnReveal){a(k.promoCouponCode).text(af.CouponCode)}a(k.promoRevealPane).show();a(k.promoHideShowWrapper).hide()};var ae=function V(af){var ag=[];if((!a.isDefined(af))||(a.isNullOrEmpty(af))){ag.push(v.missingEmail);q(k.email)}else{if(!PromoNotifier.validateEmailAddress(af)){ag.push(v.invalidEmailAddress);q(k.email)}}return ag};var u=function N(al,af,ah,ai,an,aj,am,ag){var ak={};ak[aa.Operation]=Z.GenerateCode;ak[aa.Email]=af;ak[aa.FirstName]=ah;ak[aa.LastName]=ai;ak[aa.TargetSiteId]=an;ak[aa.OfferId]=aj;a.invokeServiceEndpoint(al,ak,am,ag)};var r=function K(am,ag,ai,aj,ap,ak,an,af,ao,ah){var al={};al[aa.Operation]=Z.EmailAndSignupUser;al[aa.Email]=ag;if(a.isDefined(ai)&&a.isDefined(aj)){al[aa.FirstName]=ai;al[aa.LastName]=aj}al[aa.OfferId]=ak;al[aa.CouponCode]=af;al[aa.SignupType]=an;al[aa.TargetSiteId]=ap;a.invokeServiceEndpoint(am,al,ao,ah)};var t=function L(ah,ai,aj,af){var ag={};ag[f.Operation]=e.SetSourceCode;ag[f.SourceCode]=ai;a.invokeServiceEndpoint(ah,ag,aj,af)};var s=function M(an,af,ao,ag,ai,aj,aq,ap,ah,al,ak){var am={};am[ContestParameter.Operation]=al;am[ContestParameter.Email]=ag;am[ContestParameter.FirstName]=ai;am[ContestParameter.LastName]=aj;am[ContestParameter.ContestId]=af;am[ContestParameter.SurveyAnswers]=aq;am[ContestParameter.SignupType]=ao;am[ContestParameter.OfferId]=ak;a.invokeServiceEndpoint(PromoNotifier.contestServiceUrl,am,ap,ah)};var A=function S(ah){var af=m(ah).val();var ag=ae(af);if(a.isDefined(ag)&&ag.length>0){h(ag,null);return false}PromoNotifier.email=af;return true};var w=function P(ah){var ai=function(aj){o(PromoNotifier.waitPane);g(aj)};var ag=function(){o(PromoNotifier.waitPane)};var af=function(aj,ak){h(aj,ak,ag)};j(PromoNotifier.waitPane);r(PromoNotifier.serviceUrl,PromoNotifier.email,PromoNotifier.firstName,PromoNotifier.lastName,PromoNotifier.targetSiteId,PromoNotifier.offerId,ah,PromoNotifier.couponCode,ai,af)};var y=function Q(){if(A(k.email)){w(ab.PromoModalEmail)}};var h=function D(ai,aj,af){if(!ac.modalVisible){return}var ah=PromoNotifier.errorPane;var ag=a(k.errorContent,ah);if((!a.isDefined(ah))||(!a.isDefined(ag))){return}if((a.isDefined(aj))&&(aj.length>0)){a(k.serverErrorMessage).show();i(ah,af)}if((a.isDefined(ai))&&(ai.length>0)){a(k.validationErrorMessage).show();i(ah,af)}};var j=function W(ag,af){if((!ac.modalVisible)||(!a.isDefined(ag))){return}ag.slideDown("slow",af)};var o=function X(ag,af){if((!ac.modalVisible)||(!a.isDefined(ag))){return}ag.fadeOut("slow");if((a.isDefined(af))&&(typeof(af)==="undefined")){af()}};var n=function G(ag,af){if((!ac.modalVisible)||(!a.isDefined(ag))){return}a(k.serverErrorMessage).hide();a(k.validationErrorMessage).hide();ag.slideUp(300,af)};var i=function E(ag,af){if((!ac.modalVisible)||(!a.isDefined(ag))){return}ag.slideDown("slow",af)};var p=function I(ag,af){FB.login(function(ah){if(ah.authResponse){PromoNotifier.assignFacebookData(ag,af)}else{}},{scope:"email"})};var z=function R(aj){var af=PromoNotifier.applicationType===b.OnReveal;var ak=function(al){ah();g(al);if(af){t(PromoNotifier.customerHelperServiceUrl,al.SourceCode)}};var ah=function(){o(PromoNotifier.waitPane)};var ag=function(al,am){h(al,am,ah)};if(A(k.promoContestEmail)){var ai=null;if(af){ai=PromoNotifier.offerId}j(PromoNotifier.waitPane);s(PromoNotifier.contestServiceUrl,PromoNotifier.contestId,aj,PromoNotifier.email,PromoNotifier.firstName,PromoNotifier.lastName,[],ak,ag,ContestOperation.PromoSignup,ai)}};this.PromoNotifier={modalElement:null,errorPane:null,initialPane:null,waitPane:null,serviceUrl:null,targetSiteId:null,offerId:null,initialPane:null,email:null,firstName:"",lastName:"",customerHelperServiceUrl:null,couponCode:null,contestId:null,applicationType:null,contestServiceUrl:null,initialize:function H(ah){PromoNotifier.modalElement=a(ah.modalSelector);PromoNotifier.errorPane=a(ah.errorPaneSelector,PromoNotifier.modalElement);PromoNotifier.initialPane=a(ah.initialPaneSelector,PromoNotifier.modalElement);PromoNotifier.waitPane=a(ah.waitPaneSelector,PromoNotifier.modalElement);PromoNotifier.serviceUrl=ah.serviceUrl;PromoNotifier.targetSiteId=parseInt(ah.targetSiteId,10);PromoNotifier.offerId=parseInt(ah.offerId,10);PromoNotifier.customerHelperServiceUrl=ah.customerHelperServiceUrl;PromoNotifier.couponCode=ah.couponCode;PromoNotifier.applicationType=ah.appType;PromoNotifier.contestServiceUrl=ah.contestServiceUrl;var af=a(k.promoContestTrigger);if(a.isDefined(af)&&af.length>0){PromoNotifier.contestId=af.attr("data-contestid");af.click(function(){z(ab.PromoModalContestEmail)})}if(a.isDefined(ah.FBAppId)){PromoNotifier.loadSocialScripts(ah.facebookChannelUrl,ah.FBAppId)}var ag=a(k.email);ag.watermark({defaultText:ag.attr("placeholder")});if(ah.confirmationOnly===true){PromoNotifier.initialPane=a(k.confirmationPane,PromoNotifier.modalElement)}else{PromoNotifier.initialPane=a(k.formPane,PromoNotifier.modalElement)}PromoNotifier.show();a(k.closeButton,PromoNotifier.modalElement).click(function(ai){a.preventEventDefault(ai);TabCom.UI.Modal.hide();ac.modalVisible=false});a(k.emailSignupTrigger,PromoNotifier.modalElement).click(y);a(k.email,PromoNotifier.modalElement).keypress(function(ai){a.fireOnEnter(ai,y)});a(k.closeError,PromoNotifier.modalElement).click(function(ai){a.preventEventDefault(ai);n(PromoNotifier.errorPane)});a(k.inputBoxes,PromoNotifier.modalElement).keypress(function(ai){if(a.isDefined(ai)){if(ai.which===13){a.preventEventDefault(ai);if(A(k.email)){w(ab.PromoModalEmail)}return false}}});a(k.facebookConnect,PromoNotifier.modalElement).click(function(){p(w,ab.PromoModalFacebook)});a("#emailSignupTrigger").click(function(ai){a.preventEventDefault(ai);a(k.promoModalEmailWrapper).show();a(k.promoModalOptionsList).hide()});a(k.returnToFacebook).click(function(ai){a.preventEventDefault(ai);a(k.promoModalEmailWrapper).hide();a(k.promoModalOptionsList).show()});a(k.promoContestEmail).keypress(function(ai){a.fireOnEnter(ai,function(){z(ab.PromoModalContestEmail)})})},show:function T(){var ak=a(k.mainPane,PromoNotifier.modalElement);PromoNotifier.initialPane.show();var ag=Math.max(a(window).scrollTop(),0);var af=ak.height();var ai=Math.max((((a(window).height()-af)/2)-x.offsetTop),ag+5)+"px";var aj=ai;var al=ak.width();var ah=Math.max((((a(window).width()-al)/2)-x.offsetLeft),0)+"px";a.blockUI({message:PromoNotifier.modalElement,baseZ:1000,centerX:false,centerY:false,focusInput:false,showOverlay:true,fadeIn:700,overlayCSS:{backgroundColor:"#fff"},css:{top:aj,left:ah,position:"absolute"}});a(".blockOverlay").click(a.unblockUI);ac.modalVisible=true},validateEmailAddress:function U(af){if((!a.isDefined(af))||(a.isNullOrEmpty(af))||(typeof(af)!=="string")){return false}af=af.toLowerCase();return a.isDefined(af.match(l))},loadSocialScripts:function O(af,ah){var ag=new TabCom.UI.DeferLoader();var ai=new TabCom.ThirdPartyUtilities();ai.loadFacebookApi(ag,function(){ai.initializeFacebookApi(ah)});ag.loadScripts()},assignFacebookData:function B(ag,af){FB.api("/me",function(ah){if(ah){PromoNotifier.email=ah.email;PromoNotifier.firstName=ah.first_name;PromoNotifier.lastName=ah.last_name;if(a.isDefined(ag)&&a.isDefined(af)){ag(af)}}})}};Y.PromoNotifier=this.PromoNotifier})(TabCom.Widgets,jQuery);if((typeof(TabCom)==="undefined")||(TabCom===null)){var TabCom={}}if((typeof(TabCom.UI)==="undefined")||(TabCom.UI===null)){TabCom.UI={}}(function(a,b){this.ContestParameter={Operation:"op",Email:"em",FirstName:"fn",LastName:"ln",ContestId:"cid",Liked:"fbl",SignupType:"st",SurveyAnswers:"sa",OfferId:"oid"};this.ContestOperation={Signup:0,Like:1,Survey:2,PromoSignup:3};this.ContestSignupType={ContestEmailSignup:0,ContestFacebookSignup:1,ContestModalSignup:2,PromoModalEmail:3,PromoModalFacebook:4};a.ContestOperation=this.ContestOperation;a.ContestParameter=this.ContestParameter;a.ContestSignupType=this.ContestSignupType})(TabCom.UI);(function(K,a,y,N,O){var u=K.ContestOperation;var v=K.ContestParameter;var M=K.ContestSignupType;var x={emailAddressInput:"#contestEmail",submitEmailTrigger:".contest-signup-trigger",waitElement:"#contestWrapper .wait-screen-container",errorElement:".error-pane-container",closeErrorTrigger:".error-pane-container .error-close-link",errorMessageContent:".error-pane-container .message-content",facebookSiteLikeWrapper:".facebook-site-like-wrapper",contentWrapper:".dynamic-content-wrapper",submitFBTrigger:".signup-with-facebook",modalLinks:"#contestModalInnerWrapper a"};var H={invalidEmail:"The email address you entered is invalid.",missingParameter:"Parameter not found :"};var C=function i(V,Q,W,Y,X,R,T,S){var U={};U[v.Operation]=T;U[v.Email]=Contest.emailAddress;U[v.FirstName]=Contest.firstName;U[v.LastName]=Contest.lastName;U[v.ContestId]=Q;U[v.SignupType]=W;U[v.SurveyAnswers]=Y;U[v.OfferId]=S;a.invokeServiceEndpoint(V,U,X,R)};var D=function j(U,Q,S,V,R){var T={};T[v.Operation]=u.Like;T[v.ContestId]=Q;T[v.Liked]=S;a.invokeServiceEndpoint(U,T,V,R)};var A=function(){var R={};var S=[];var Q=a(".survey-answers");var U=false;var T=function(V){var W=[];W.push(V.val());return W};a.each(Q,function(){var V=a(this);if(V.is("input:text")&&!a.isNullOrEmpty(V.val())){U=true;R[V.attr("data-answerid")]=T(V)}else{if(V.is("input:radio")&&V.is(":checked")){U=true;R[V.attr("data-answerid")]=T(V)}else{if(V.is("input:checkbox")&&V.is(":checked")){U=true;var W=V.attr("data-answerid");if(a.inArray(W,S)>-1){return}S.push(W);var X=[];a.each(Q,function(){$me=a(this);if($me.attr("data-answerid")==W&&$me.is(":checked")){X.push($me.val())}});R[W]=X}else{if(V.is("select")&&V.val()!=0){U=true;R[V.attr("data-answerid")]=T(V)}}}}});return(a.isDefined(R)&&U!=false)?JSON.stringify(R):""};var L=function q(R,S,Q){a.cookie(R+"_"+Q,1,S)};var P=function t(Q,U,T){var R=[];if(!Contest.emailValidator.validateEmailAddress(Contest.emailAddress)){R.push(H.invalidEmail)}if(R.length>0){w(R);return false}Contest.waitElement.fadeIn();var V=function(W){var X=a(x.contentWrapper);L(Contest.cookieName,Contest.cookieExpiration,Contest.contestId);Contest.facebookLoaded=false;X.html(W.ConfirmationContent);if(a.isDefined(Contest.eventTracker)){b(Contest.eventTracker.reinitialize,Contest.scriptSubscriber)}F(Contest.deferLoader,Contest.facebookChannelUrl);Contest.revealConfirmation();Contest.waitElement.hide()};var S=function(W){Contest.waitElement.hide();w(W)};C(Contest.serviceUrl,Q,U,A(),V,S,T)};var w=function d(S){var R=S.length;var Q=0;var T=a(x.errorMessageContent,Contest.wrapper);for(Q=0;Q<R;Q++){T.append("<p>"+S[Q]+"</p>")}Contest.errorElement.show()};var I=function n(R,Q){if(R.length===0){throw"Input container not found."}var S=R.position();Q.css({height:R.height()-50,width:R.width()-10,left:S.left,top:S.top})};var E=function k(Q){return(a.isDefined(Q)&&typeof(Q)==="function")};var b=function c(R,S){if(E(R)){var Q={};a.extend(Q,new y.Observer());Q.update=function(T){R(T)};S.addObserver(Q)}};var G=function m(Q){if(Q!=null){D(Contest.serviceUrl,Contest.contestId,true,null,null)}};var F=function l(R,Q){var S=Contest.thirdPartyUtilities;S.loadFacebookApi(R,function(){S.initializeFacebookApi(Contest.appId,function(){Contest.scriptSubscriber.notify()})});R.loadScripts()};var B=function(R){FB.login(function(S){if(S.authResponse){Q()}else{}},{scope:"email, user_likes"});function Q(){FB.api("/me",function(S){if(S){Contest.emailAddress=S.email;Contest.firstName=S.first_name;Contest.lastName=S.last_name;if(E(R)){R(S)}}})}};var J=function p(){a(x.modalLinks).each(function(){var Q=a(this);var R=Q.prop("href");Q.click(function(S){if(!a.isNullOrEmpty(R)){a.preventEventDefault(S);window.top.location.href=R}});Q.attr("href",null)})};var z=function f(R,Q){P(Contest.contestId,R,Q)};this.Contest={wrapper:null,contestId:null,serviceUrl:null,emailValidator:null,waitElement:null,inputWrapper:null,errorElement:null,facebookSiteUrl:null,deferLoader:null,cookieName:null,cookieExpiration:null,facebookChannelUrl:null,emailAddress:null,appId:null,showRevealPane:false,firstName:"",lastName:"",eventTracker:null,facebookLoaded:false,isInitialized:false,siteName:null,facebookApi:null,likeSubscriber:{},authorizeSubscriber:{},scriptSubscriber:{},thirdPartyUtilities:null,initialize:function h(S){if(!a.isDefined(S.emailValidator)){throw H.invalidParameter+" Email validator"}Contest.wrapper=a(S.wrapper);Contest.contestId=parseInt(S.contestId,10);Contest.emailValidator=S.emailValidator;Contest.waitElement=a(x.waitElement);Contest.inputWrapper=a(S.inputWrapper);Contest.errorElement=a(x.errorElement,Contest.wrapper);Contest.serviceUrl=S.serviceUrl;Contest.facebookSiteUrl=S.facebookSiteUrl;Contest.deferLoader=S.deferLoader;Contest.thirdPartyUtilities=new N();Contest.cookieName=S.cookieName;Contest.cookieExpiration=S.cookieExpiration;Contest.facebookChannelUrl=S.facebookChannelUrl;Contest.appId=!a.isNullOrEmpty(S.fbAppId)?S.fbAppId:"2530096808";Contest.showRevealPane=!a.isNullOrEmpty(S.showRevealPane)?S.showRevealPane:false;I(Contest.wrapper,Contest.waitElement);a.extend(Contest.likeSubscriber,new y.Subject());b(G,Contest.likeSubscriber);Contest.onSocialInit=function(){FB.Event.subscribe("edge.create",function(U,T){Contest.likeSubscriber.notify(U)});FB.Event.subscribe("edge.remove",function(T){if(T!=null){D(Contest.serviceUrl,Contest.contestId,false,null,null)}})};if(!Contest.showRevealPane){I(Contest.inputWrapper,Contest.errorElement)}Contest.emailAddress=!a.isNullOrEmpty(S.emailAddress)?S.emailAddress:"";var Q=a(x.emailAddressInput);var R=u.Signup;Q.keypress(function(T){Contest.emailAddress=Q.val();return a.fireOnEnter(T,function(){var U=M.ContestEmailSignup;z(U,R)})});a(x.submitEmailTrigger).click(function(){Contest.emailAddress=Q.val();z(M.ContestEmailSignup,R)});a(x.submitFBTrigger).click(function(){B(function(){var T=M.ContestFacebookSignup;z(T,R)})});a(x.closeErrorTrigger,Contest.wrapper).click(function(T){a.preventEventDefault(T);a(x.errorMessageContent,Contest.wrapper).html("");if(Contest.showRevealPane){window.top.TabCom.ModalContest.hideModal()}else{Contest.errorElement.hide()}});a.extend(Contest.scriptSubscriber,new y.Subject());b(Contest.onSocialInit,Contest.scriptSubscriber);if(!Contest.showRevealPane){F(Contest.deferLoader,Contest.facebookChannelUrl)}if(S.returning===true||Contest.showRevealPane){Contest.revealConfirmation()}if(Contest.showRevealPane===true){J();z(M.ContestModalSignup,R)}Contest.isInitialized=true},fillInfo:function e(Q){Contest.firstName=Q.firstName;Contest.lastName=Q.lastName;Contest.emailAddress=Q.email;a(x.emailAddressInput).val(Contest.emailAddress)},submitEmail:function s(Q){Contest.emailAddress=Q.email;Contest.firstName=Q.firstName;Contest.lastName=Q.lastName;C(Contest.serviceUrl,Contest.contestId,Q.signupType,A(),Q.successCallback,Q.failureCallback,u.PromoSignup,Q.offerId)},revealConfirmation:function o(U){var R=a(x.facebookSiteLikeWrapper);var S=null;var T=null;var Q=null;if(R.length>0){S=R.height();T=R.width();Q=document.createElement("iframe");Q.src=Contest.facebookSiteUrl;Q.scrolling="no";Q.frameBorder="0";Q.height=S;Q.width=T;Q.allowTransparency="true";R.append(Q)}FB.XFBML.parse();J()},setEventTracker:function r(Q){Contest.eventTracker=Q},initFacebook:function g(Q){b(function(R){if(E(Q.onLike)){Q.onLike(R)}},Contest.likeSubscriber);a.extend(Contest.authorizeSubscriber,new y.Subject());if(E(Q.onConnected)){if(!a.isDefined(Contest.siteName)){a.logToConsole("onConnected callback defined but siteName is not.");return}b(function(T){if(!a.isDefined(T)||T.status!=="connected"){return}var S=[];var R=false;Contest.facebookApi.api("/me",{fields:"first_name, email, last_name, user_likes"},function(U){if(!a.isDefined(U)||!a.isDefined(U.user_likes)||!a.isDefined(U.user_likes.data)){return}S=U.user_likes.data;a.each(S,function(V,W){if(W.name.toLowerCase()===Contest.siteName.toLowerCase()){R=true;return}});Q.onConnected({firstName:U.first_name,lastName:U.last_name,hasLiked:R,email:U.email})})},Contest.authorizeSubscriber)}if(E(Q.onUnauthorized)){b(function(R){if(!a.isDefined(R)||R.status!=="not_authorized"){return}Q.onUnauthorized(R)},Contest.authorizeSubscriber)}if(E(Q.onLoggedOut)){b(function(R){if(!a.isDefined(R)||R.status==="unknown"){Q.onLoggedOut(R)}},Contest.authorizeSubscriber)}b(function(){Contest.facebookApi.getLoginStatus(function(R){Contest.authorizeSubscriber.notify(R)});Contest.facebookApi.Event.subscribe("auth.authResponseChange",function(R){Contest.authorizeSubscriber.notify(R)})},Contest.scriptSubscriber)}};K.Contest=this.Contest})(TabCom.UI,$,TabCom.Event,TabCom.ThirdPartyUtilities);if((typeof(TabCom)==="undefined")||(TabCom===null)){var TabCom={}}if((typeof(TabCom.Widgets)==="undefined")||(TabCom.Widgets===null)){TabCom.Widgets={}}(function(p,a){var f={parentWrapper:"#shareAndSaveWrapper",fbShareLink:".facebook-share-link",fbForm:"#shareAndSaveFb",fbFormFirst:"#shareAndSaveFbFirst",fbFormLast:"#shareAndSaveFbLast",fbFormEmail:"#shareAndSaveFbEmail",fbFormSubmit:"#shareAndSaveFbSubmit",twitterShareLink:".twitter-share-link",emailSharelink:".email-share-link",closeSelector:".close-modal",formErrorSelector:".error-message",errorReturnLink:".error-go-back",formWrapper:".form-wrapper",startScreen:"#shareAndSaveStart",confirmScreen:"#shareAndSaveConfirm",errorMesage:"#shareAndSaveError",waitScreen:"#shareAndSaveWait",emailForm:"#shareAndSaveEmail",emailFormFirst:"#shareAndSaveEmailFirst",emailFormLast:"#shareAndSaveEmailLast",emailFormEmail:"#shareAndSaveEmailEmail",emailFormFriends:"#shareAndSaveEmailFriends",emailFormSubmit:"#shareAndSaveEmailSubmit",twitterForm:"#shareAndSaveTwitter",twitterFormFirst:"#shareAndSaveTwitterFirst",twitterFormLast:"#shareAndSaveTwitterLast",twitterFormEmail:"#shareAndSaveTwitterEmail",twitterFormSubmit:"#shareAndSaveTwitterSubmit",modalTrigger:".share-and-save-modal-trigger",topNavSelector:"#topNavMenuContainer",personalMessage:"#shareMessageText",mainWrapper:"#MainWrapper",contactPane:"#shareAndSaveContactResults",goBackButton:".share-and-save-reset",shareSaveFaq:"#shareSaveFaq"};var w={facebook:0,twitter:1,email:2};var k={nullFields:"Please fill out all the fields in the form and hit submit.",invalidEmail:"The email addess you entered is not a valid email address.",messageRequired:"Please enter a personal message and try again.",tokenGetFail:"There was a problem retrieving your share url.  Please try again.",failedRequest:"There was a problem with your request. Please try again.",facebookError:"There was a problem retrieving your facebook data.  Please try again later.",invalidSendTo:"We're sorry, the email was not sent: One or more of the email addresses you've entered is invalid. Please verify that you've entered the email addresses correctly. Multiple email addresses must be separated by a comma (,)."};var j=function t(M,O,G,Q,B,D,E,L,N,I,F,K,P,C){var J=TabCom.Widgets.PromoParameter;var H={};H[J.Email]=B;H[J.FirstName]=D;H[J.LastName]=E;H[J.SignupType]=O;H[J.Operation]=G;H[J.TargetSiteId]=Q;H[J.SendToEmailList]=L;H[J.ShareUrl]=N;H[J.PersonalMessage]=I;H[J.OfferText]=F;H[J.ReferralId]=K;a.invokeServiceEndpoint(M,H,P,C)};var i=function s(F,C,G,I,H,B){var E=TabCom.Widgets.PromoParameter;var D={};D[E.Operation]=C;D[E.ShareType]=G;D[E.SplitTestVersionId]=I;a.invokeServiceEndpoint(F,D,H,B)};var l=function(D,E,B,G){var H=ShareAndSave.serviceUrl,K=ShareAndSave.targetSiteId,I=ShareAndSave.signupType,F=TabCom.Widgets.PromoOperation.SignupUser,J=function(){ShareAndSave.parentWrapper.find("div").each(function(){var L=a(this);if(L.data("paneltype")==="dataEntryPanel"){L.hide()}});a(f.confirmScreen).show();h()},C=function(){ShareAndSave.parentWrapper.find("div").each(function(){var L=a(this);if(L.data("paneltype")==="dataEntryPanel"){L.hide()}});x(k.failedRequest)};j(H,I,F,K,B,D,E,G,ShareAndSave.shareLink,ShareAndSave.messageText,ShareAndSave.offerText,ShareAndSave.referralId,J,C)};var y=function(){ShareAndSave.parentWrapper.find(f.waitScreen).show()};var h=function(){ShareAndSave.parentWrapper.find(f.waitScreen).hide()};var g=function(B,E){y();var F=function(G){if(a.isNullOrEmpty(G)){x(k.tokenGetFail);return}ShareAndSave.shareLink=G.ShareUrl;ShareAndSave.referralId=G.ReferralId;B()};var C=function(G){x(k.tokenGetFail)};var D=TabCom.Widgets.PromoOperation.GenerateShareLink;i(ShareAndSave.serviceUrl,D,E,ShareAndSave.versionTestId,F,C)};var x=function(B){ShareAndSave.parentWrapper.find(f.errorMesage).find(f.formErrorSelector).text(B).end().show();h()};var z=function(D,F,B,H){var E=a.isDefined(H);if(a.isNullOrEmpty(D)||a.isNullOrEmpty(F)||a.isNullOrEmpty(B)||(E&&a.isNullOrEmpty(H))){x(k.nullFields);return false}else{if(!ShareAndSave.promoNotifier.validateEmailAddress(B)){x(k.invalidEmail);return false}else{if(E){var C=H.split(","),G=true;a.each(C,function(I){var J=C[I].trim();if(!ShareAndSave.promoNotifier.validateEmailAddress(J)){x(k.invalidSendTo);G=false;return false}});return G}}}return true};var A=function(B){var C=ShareAndSave.parentWrapper.find(f.personalMessage).val();if(B&&a.isNullOrEmpty(C)){x(k.messageRequired);return false}ShareAndSave.messageText=C;return true};var b=function(){y();var C=ShareAndSave.parentWrapper.find(f.emailFormFirst).val(),D=ShareAndSave.parentWrapper.find(f.emailFormLast).val(),B=ShareAndSave.parentWrapper.find(f.emailFormEmail).val(),E=ShareAndSave.parentWrapper.find(f.emailFormFriends).val();if(!z(C,D,B,E)){return}g(function(){l(C,D,B,E)},w.email)};var e=function(B){y();var D=ShareAndSave.parentWrapper.find(f.twitterFormFirst).val(),E=ShareAndSave.parentWrapper.find(f.twitterFormLast).val(),C=ShareAndSave.parentWrapper.find(f.twitterFormEmail).val();if(!z(D,E,C,undefined)){return}o(B);l(D,E,C,undefined)};var o=function(B){var D=encodeURIComponent(ShareAndSave.messageText+" "+B.data("text")+" "+ShareAndSave.shareLink),C=a(window);width=575,height=400,left=(C.width()-width)/2,top=(C.height()-height)/2,url=B.data("link"),opts="status=1,width="+width+",height="+height+",top="+top+",left="+left;window.open(url+D,"twitter",opts)};var n=function(B){if(!window.location.origin){window.location.origin=window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:"")}FB.api("/me/feed","post",{message:ShareAndSave.messageText,link:ShareAndSave.shareLink,description:B,picture:window.location.origin+"/images/logo-mini.gif"},function(C){if(C&&!C.error){}else{if(C){a.logToConsole(C.error.message);x(k.facebookError)}}})};var d=function(B){y();var D=ShareAndSave.parentWrapper.find(f.fbFormFirst).val(),E=ShareAndSave.parentWrapper.find(f.fbFormLast).val(),C=ShareAndSave.parentWrapper.find(f.fbFormEmail).val();if(!z(D,E,C,undefined)){return}var F=function(){n(B);l(D,E,C,undefined)};g(F,w.facebook)};var c=function(B){function C(){if(A(false)){var D=ShareAndSave.promoNotifier;var E=function(){y();if(a.isNullOrEmpty(D.lastName)||a.isNullOrEmpty(D.lastName)||a.isNullOrEmpty(D.email)){a(f.fbFormFirst).val(D.firstName);a(f.fbFormLast).val(D.lastName);a(f.fbFormEmail).val(D.email);a(f.fbForm).show();a(f.startScreen).hide();h()}else{var F=function(){n(B);l(D.firstName,D.lastName,D.email,undefined)};g(F,w.facebook,D.email)}};D.assignFacebookData(E,ShareAndSave.signupType,D.email)}}FB.login(function(D){if(D.authResponse){C()}else{x(k.facebookError)}},{scope:"public_profile, email, publish_actions"})};var m=function(){var D=a(window),C=a(f.modalTrigger),B=a(f.mainWrapper),F=ShareAndSave.parentWrapper.data("minpageheight"),G=ShareAndSave.parentWrapper.data("minpagewidth");function E(){var M=D.width(),L=D.height(),H=B.width(),I=(Math.max((M-H),0)/2)+H,K=10,J=a(f.topNavSelector);if(M>G||L>F){K=J.offset().top+J.height()}C.css({left:I,top:K}).show()}E();D.resize(E)};this.ShareAndSave={parentWrapper:null,modalWrapper:null,promoNotifier:null,shareLink:null,serviceUrl:null,targetSiteId:null,twitterText:null,messageText:null,signupType:null,offerText:null,isInitialized:false,isModal:false,versionTestId:null,referralId:null,initialize:function r(D){ShareAndSave.promoNotifier=D.promoNotifier;ShareAndSave.parentWrapper=a(f.parentWrapper);ShareAndSave.serviceUrl=D.serviceUrl;ShareAndSave.targetSiteId=D.targetSiteId;ShareAndSave.twitterText=D.twitterText;ShareAndSave.signupType=TabCom.Widgets.SignupType.ShareAndSave;ShareAndSave.modalWrapper=D.modalWrapper;ShareAndSave.isInitialized=true;ShareAndSave.isModal=D.isModal||false;ShareAndSave.offerText=ShareAndSave.parentWrapper.data("offertext");ShareAndSave.versionTestId=D.versionTestId;if(!a.isDefined(ShareAndSave.offerText)||a.isNullOrEmpty(ShareAndSave.offerText)){throw"Offer Text is undefined."}ShareAndSave.promoNotifier.loadSocialScripts(D.facebookChannelUrl,D.FBAppId);if(ShareAndSave.isModal){m()}ShareAndSave.parentWrapper.find(f.fbShareLink).on("click",function(G){G.preventDefault();var F=a(this).data("text");c(F);return false});ShareAndSave.parentWrapper.find(f.fbFormSubmit).on("click",function(G){G.preventDefault();if(A(false)){var F=ShareAndSave.parentWrapper.find(f.fbShareLink).data("text");d(F)}return false});ShareAndSave.parentWrapper.find(f.emailSharelink).on("click",function(F){F.preventDefault();if(A(false)){ShareAndSave.parentWrapper.find(f.startScreen).hide();ShareAndSave.parentWrapper.find(f.emailForm).show();h()}return false});ShareAndSave.parentWrapper.find(f.emailFormSubmit).on("click",function(F){F.preventDefault();b();return false});ShareAndSave.parentWrapper.find(f.twitterShareLink).on("click",function(F){F.preventDefault();if(A(false)){var G=function(){ShareAndSave.parentWrapper.find(f.startScreen).hide();ShareAndSave.parentWrapper.find(f.twitterForm).show();h()};g(G,w.twitter)}return false});ShareAndSave.parentWrapper.find(f.twitterFormSubmit).on("click",function(G){G.preventDefault();var F=ShareAndSave.parentWrapper.find(f.twitterShareLink);e(F);return false});ShareAndSave.parentWrapper.find(f.errorReturnLink).on("click",function(F){F.preventDefault();ShareAndSave.parentWrapper.find(f.errorMesage).hide();return false});ShareAndSave.parentWrapper.closest(".RoundCorners").find(f.closeSelector).on("click",function(F){F.preventDefault();ShareAndSave.hide();return false});var B=ShareAndSave.parentWrapper.find(f.formWrapper);a.each(B,function(G){var F=a(this);F.find("input").last().on("keypress",function(H){function I(){F.find("button").click()}a.fireOnEnter(H,I)})});a(f.modalTrigger).on("click",function(F){ShareAndSave.show()});a(f.goBackButton).on("click",function(F){F.preventDefault();ShareAndSave.returnToStartScreen();return false});a(f.shareSaveFaq).on("click",function(G){G.preventDefault();var F=parseInt(a(this).data("article"),10);a.openContentWindow(F,1,500,800)});var C=new TabCom.ThirdParty.ContactRetriever({launchUrl:D.googleLaunchUrl,triggerSelector:".launch-google-contacts",emailFieldSelector:"#shareAndSaveEmailFriends",initialPaneSelector:"#shareAndSaveEmail"});var E=new TabCom.ThirdParty.ContactRetriever({launchUrl:D.yahooLaunchUrl,triggerSelector:".launch-yahoo-contacts",emailFieldSelector:"#shareAndSaveEmailFriends",initialPaneSelector:"#shareAndSaveEmail"})},show:function v(){var B=a(window),D=a(ShareAndSave.modalWrapper),C=Math.max(B.scrollTop(),0),E=Math.max(((B.width()-D.width())/2),0)+"px";modalTop=((B.height()-D.height())/2)+C+"px",options={centerX:false,centerY:false,css:{top:modalTop,left:E,position:"absolute"},baseZ:1000,focusInput:false,message:D};TabCom.UI.Modal.show(options)},hide:function q(){TabCom.UI.Modal.hide();setTimeout(ShareAndSave.returnToStartScreen,500)},returnToStartScreen:function u(B){ShareAndSave.parentWrapper.find(f.errorMesage).hide().end().find("input[type=text], input[type=email]").val("").end().find("textarea").val("").end().find(f.waitScreen).hide().end().find(f.confirmScreen).hide().end().find(f.fbForm).hide().end().find(f.twitterForm).hide().end().find(f.emailForm).hide().end().find(f.contactPane).hide().end().find(f.startScreen).show();if(a.isDefined(B)&&typeof B==="function"){B()}}};p.ShareAndSave=this.ShareAndSave})(TabCom.Widgets,jQuery);if((typeof(TabCom)==="undefined")||(TabCom===null)){var TabCom={}}if((typeof(TabCom.ThirdParty)=="undefined")||(TabCom.ThirdParty===null)){TabCom.ThirdParty={}}(function(i,j){var h={resultsSelector:".contact-results",resultsWrapper:".contact-results-wrapper",searchSelector:".search-contacts",selectAll:".select-all-contacts",deselectAll:".deselect-all-contacts",backButton:".go-back",selectionPane:".provider-selection",resultsPane:".results-pane",acceptEmails:".accept-contact-list"};var a=function(k){this.launchUrl=k.launchUrl;this.resultsElement=$(h.resultsSelector);this.searchElement=$(h.searchSelector);this.trigger=$(k.triggerSelector);this.emailFieldSelector=$(k.emailFieldSelector);this.initialPaneSelector=$(k.initialPaneSelector);this.selectAllTrigger=$(h.selectAll);this.deselectAllTrigger=$(h.deselectAll);this.backButton=$(h.backButton);this.acceptEmails=$(h.acceptEmails);this.selectAllChecked=false;this.unbindClickEvents();var n=this;this.trigger.on("click",function(){window.contactRetriever=n;n.launch(n)});function m(o){n.resultsElement.find("li").filter(function(){var p=$(this);if(p.is(":visible")){if(o.is(":checked")){p.find("input").prop("checked",true);n.selectAllChecked=true}else{p.find("input").prop("checked",false);n.selectAllChecked=false}}})}this.selectAllTrigger.on("change",function(){m($(this))});this.backButton.on("click",function(){n.closeAndReturn()});this.acceptEmails.on("click",function(o){o.preventDefault();var s=$(this).parent().find("li"),p=[],r="",q=0;$.each(s,function(v){var w=$(this).find("input");if(w.prop("checked")===true){p.push(w.data("email").toString())}});q=p.length;$.each(p,function(v,w){r+=w;if(v!=q-1){r+=", "}});var u=n.emailFieldSelector.val(),t=u;if(!$.isNullOrEmpty(u)){t=t+", "+r}else{t=r}n.emailFieldSelector.val(t);n.closeAndReturn();return false});function l(q){var o=q.value.trim().toLowerCase(),p=n.resultsElement.find("li"),r=function(){n.selectAllTrigger.prop("checked",false);n.selectAllChecked=false};p.hide();p.filter(function(s,t){if(n.selectAllChecked&&!$(this).find("input:checked").length==0){r()}if(q.value===""){p.show();return}if(t.textContent.toLowerCase().indexOf(o)>=0){return true}return false}).show()}this.searchElement.on("input",function(){l(this)})};a.prototype={unbindClickEvents:function g(){this.searchElement.off("input");this.backButton.off("click");this.acceptEmails.off("click");this.deselectAllTrigger.off("click");this.selectAllTrigger.off("click")},launch:function f(k){if($.isDefined(k.result)){k.onRetrieve(k.result);return}window.open(k.launchUrl,"_blank","menubar=0,status=0,toolbar=0,scrollbars=1,resizable=1,location=0,height="+436+",width="+626)},onRetrieve:function e(k){this.result=k;var l=this.result.Result.length;$(h.resultsPane).show();this.searchElement.val("");this.initialPaneSelector.hide();if(l>0){$(h.selectionPane).hide()}this.selectAllTrigger.prop("checked",false);this.buildList()},buildList:function b(){var n=this,m=$(h.resultsWrapper);if($.isDefined(n.result)){n.resultsElement.detach().empty();if(n.result.Result.length==0){var l=$("<p/>").text("There are no contacts available in your contact list.");n.resultsElement.append(l).appendTo(m)}var k=$("<ul/>");$.each(n.result.Result,function(p,o){k.append(n.buildListElement(o))});n.resultsElement.append(k).appendTo(m)}},buildListElement:function c(l){var n=$("<li/>");var k=$("<input/>").prop("type","checkbox").data("email",l.EmailAddress);var m="<span>"+this.checkNullValue(l.FirstName)+" "+this.checkNullValue(l.LastName)+"</span> - "+this.checkNullValue(l.EmailAddress);n.append(k).append(m);return n},checkNullValue:function d(k){if($.isNullOrEmpty(k)){return""}return k},closeAndReturn:function d(k){$(h.resultsPane).hide();this.initialPaneSelector.show()}};i.ContactRetriever=a})(TabCom.ThirdParty,jQuery);